---
output: html_document
editor_options: 
 chunk_output_type: console
---

# Compare U.S. totals of mapped variables, tax-microdata-benchmarking vs. IRS published CD values


## Setup 
```{r}
#| label: setup

source(here::here("R", "libraries.R"))
source(here::here("R", "constants.R"))
source(here::here("R", "functions.R"))

```

## Get data

```{r}
#| label: get-data
#| output: false

vmap <- read_csv(fs::path(CDINTERMEDIATE, "cd_variable_mapping.csv"))
cdirs <- read_csv(fs::path(CDINTERMEDIATE, "cdbasefile_sessions.csv"))

TMDDIR <- here::here("..", "..", "..", "storage", "output")
fpath <-  fs::path(TMDDIR, "cached_allvars.csv")
tmd2021 <- vroom(fpath)
ns(tmd2021)

```

## Create comparison file

```{r}
#| label: create-comp
#| output: false

vmap

#.. cd data ----
cd2 <- cdirs |> 
  filter(basevname %in% vmap$basevname,
         session==118,
         scope==1)

count(cd2, basevname, vname)
count(cd2, rectype)
skim(cd2)

cd3 <- cd2 |> 
  summarise(target=sum(target),
            .by=c(basevname, count, agistub, agirange, description))

#.. tmd data ----



```

